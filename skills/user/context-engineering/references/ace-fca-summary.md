# ACE-FCA: Advanced Context Engineering for Coding Agents 要約

**Source**: [HumanLayer ACE-FCA](https://github.com/humanlayer/advanced-context-engineering-for-coding-agents)

---

## 概要

ACE-FCA（Advanced Context Engineering for Coding Agents）は、AIコーディングエージェントが**複雑な本番コードベースで効果的に機能する**ための実践的アプローチ。

### 背景

Stanfordの研究により、AIツールは**大規模で確立されたコードベースでは生産性を低下させる**ことが判明。

一般的な課題：
- 不要なコード修正による「スロップ」の増加
- 複雑なシステムでの失敗
- ブラウンフィールドプロジェクトでの効率低下

---

## 核心戦略：頻繁で意図的なコンパクション

### コンセプト

開発プロセス全体を**コンテキスト管理中心**に再設計。

> "単一の魔法のプロンプトは存在しない"
> — 人間の判断とシステマティックなアプローチが必須

### 3段階ワークフロー

```
┌─────────────┐
│  Research   │ コードベース構造の理解、関連ファイル特定
│   (調査)    │ 情報フローと問題原因の特定
└─────────────┘
       ↓ 圧縮
┌─────────────┐
│    Plan     │ 具体的な実装ステップの概説
│   (計画)    │ テスト・検証手順の詳細化
└─────────────┘
       ↓ 圧縮
┌─────────────┐
│  Implement  │ 計画をフェーズごとに実行
│   (実装)    │ 各段階完了後にステータス更新
└─────────────┘
```

---

## コンテキストウィンドウの最適化

### 優先順位

1. **正確性** — 誤った情報が最も危険
2. **完全性** — 欠落情報は次に悪い
3. **ノイズレス性** — 余分な情報は避ける

### 使用率目標

**40-60%の範囲を維持**

| 使用率 | 状態 | 対応 |
|--------|------|------|
| <40% | 最適 | 継続 |
| 40-60% | 許容 | 監視 |
| 60-80% | 警告 | コンパクション |
| >80% | 危険 | 即時対応 |

---

## 実践例：BAML プロジェクト

300k行のRustコードベースでの成果：

| タスク | ACE-FCA適用 | 従来推定 |
|--------|-------------|----------|
| 初回バグ修正 | 1時間 | 数時間〜1日 |
| 大規模機能実装（35k行追加） | 7時間 | 3-5日 |

---

## 意図的コンパクションの手法

### コンパクションのタイミング

- 各フェーズ完了時
- エラー発生時
- コンテキスト使用率60%超過時

### コンパクションの方法

**進捗をMarkdownファイルに要約**：

```markdown
## Progress Summary

### Completed
- [完了したタスク、各1行]

### Current State
- [現在の状態、2-3文]

### Next Steps
- [次のアクション、各1行]

### Blockers
- [障害があれば記載]
```

### コンパクションの原則

**保持するもの**：
- 結論と決定事項
- 具体的な数値・名前・パス
- 次フェーズに必要な情報

**破棄するもの**：
- 詳細な探索過程
- 却下した選択肢の詳細
- 冗長な説明

---

## サブエージェントの活用

### 目的

調査タスクを独立したサブエージェントに委譲し、メインエージェントのコンテキストをクリーンに保持。

### 構造

```
メインエージェント
    ├── サブエージェント1: ファイル構造調査 → 要約返却
    ├── サブエージェント2: エラー分析 → 要約返却
    └── サブエージェント3: 類似パターン調査 → 要約返却
```

### 原則

- サブエージェントは**READ-ONLY**操作のみ
- 返却は**要約のみ**（詳細な生データは返さない）
- 並列実行でコンテキスト効率を最大化

---

## 成功の必須要素

### 人間の関与

- 高レベルなレビューポイントの設計
- 重要な意思決定での介入
- 完全自律ではなく協調

### 専門知識

- コードベース経験者との協働が推奨
- ドメイン知識がコンテキスト品質を向上

### 反復的評価

- 不正確な出力の検出と修正
- 継続的な改善サイクル

### 仕様駆動開発

- 「プロンプト」より「仕様」を重視
- 明確な入出力定義

---

## 制限と教訓

### すべての問題が解決可能ではない

例：Hadoop依存関係除去の試み
- 複雑な依存関係を持つタスクは困難
- モデルの改善を待つより、今日のモデルから最大限を引き出すことに注力

### 技術的工芸としての位置づけ

ACE-FCAは「技術的工芸」：
- 機械的適用ではなく、状況に応じた判断が必要
- 経験により精度が向上

---

## Context Engineeringへの統合

| ACE-FCA概念 | Context Engineering適用 |
|-------------|------------------------|
| 3段階ワークフロー | Research-Plan-Implement構造 |
| 意図的コンパクション | フェーズ間情報圧縮 |
| サブエージェント | タスク委譲パターン |
| 使用率40-60% | コンテキスト予算管理 |

---

**Last Updated**: 2025-12-06
